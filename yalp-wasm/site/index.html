<html>
    <head>
        <title>WASM lisp interpreter</title>
        <script src="jquery.min.js"></script>
        <script src="jquery.terminal.min.js"></script>
        <link href="terminal.css" rel="stylesheet"/>

        <script>
            // This is read and used by `site.js`
            var Module = {
                wasmBinaryFile: "site.wasm",
                onRuntimeInitialized: main,
            };
            function main() {
                var free_state = Module.cwrap('free_state', 'void', ['number']);
                var create_state = Module.cwrap('create_state', 'number', []);
                var exec_command = Module.cwrap('exec_command', 'string', ['string', 'number']);

                var state = create_state();

                jQuery(function($, undefined) {
                    $('body').terminal(function(command) {
                        if (command === "help") {
                            this.echo(
                                'This is a lisp repl written in Rust, compiled to WASM and now running inside a virtual machine in your browser. ' +
                                'The built-in functions are add1, sub1, zero?, car, cdr, cons, null?, ' +
                                'list, int?, bool?, list? and bool. Further, there are three macros: define, lambda and cond.' +
                                '\nTry defining addition: (define + (lambda (x y) (cond (zero? y) x (+ (add1 x) (sub1 y)))))'
                            );
                        } else {
                            let output = exec_command(command, state);
                            this.echo(output);
                        }
                    }, {
                        greetings: 'WASM lisp interpreter. Type help for instructions',
                        name: 'lisp_demo',
                        prompt: '> '
                    });
                });
            }
        </script>
        <script src="site.js"></script>
    </head>
    <body></body>
</html>
